<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Praha 2 Sobƒõ ‚Äî Mapa volebn√≠ch okrsk≈Ø</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f3f4f6; color: #111827; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

.header { padding: 12px 16px; background: #fff; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; }
.header h1 { font-size: 1.1rem; font-weight: 700; }
.header p { font-size: 0.75rem; color: #6b7280; }

.main { flex: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; }

#map { flex: 1; z-index: 1; }

/* Sidebar as bottom sheet on mobile */
.sidebar { position: absolute; bottom: 0; left: 0; right: 0; z-index: 1000; background: #fff; border-radius: 16px 16px 0 0; box-shadow: 0 -4px 20px rgba(0,0,0,0.15); max-height: 70vh; overflow-y: auto; transform: translateY(100%); transition: transform 0.3s ease; }
.sidebar.open { transform: translateY(0); }
.sidebar-handle { display: flex; justify-content: center; padding: 14px; cursor: pointer; flex-shrink: 0; position: sticky; top: 0; background: #fff; border-radius: 16px 16px 0 0; z-index: 1; }
.sidebar-handle::before { content: ''; width: 40px; height: 4px; background: #d1d5db; border-radius: 2px; }
/* Info button floating on map for mobile */
.info-btn { display: none; position: absolute; bottom: 64px; right: 12px; z-index: 999; width: 44px; height: 44px; border-radius: 50%; background: #fff; border: 2px solid #e5e7eb; box-shadow: 0 2px 8px rgba(0,0,0,0.15); font-size: 1.2rem; cursor: pointer; align-items: center; justify-content: center; }
@media (max-width: 767px) { .info-btn { display: flex; } }
.sidebar-content { padding: 0 16px 20px; }

/* Desktop: sidebar on the right */
@media (min-width: 768px) {
  .main { flex-direction: row; }
  #map { flex: 1; border-radius: 12px; margin: 12px; border: 1px solid #e5e7eb; }
  .sidebar { position: relative; transform: none; width: 300px; max-height: none; border-radius: 0; box-shadow: none; border-left: 1px solid #e5e7eb; flex-shrink: 0; overflow-y: auto; }
  .sidebar-handle { display: none; }
  .sidebar-content { padding: 16px; }
}

.card { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 14px; margin-bottom: 12px; }
.card h3 { font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; }
.card-yellow { border-color: #fde68a; background: #fefce8; }
.stat-row { display: flex; justify-content: space-between; font-size: 0.8rem; padding: 2px 0; }
.stat-label { color: #6b7280; }
.stat-val { font-weight: 600; }
.yellow { color: #a16207; }
.red { color: #dc2626; }
.amber { color: #d97706; }
.green { color: #16a34a; }
.hood { padding: 10px; border-radius: 8px; border: 1px solid #f3f4f6; margin-bottom: 6px; }
.hood-name { font-weight: 500; font-size: 0.875rem; }
.hood-meta { font-size: 0.7rem; color: #9ca3af; }
.hood-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-top: 4px; font-size: 0.75rem; }
.close-btn { float: right; cursor: pointer; color: #9ca3af; font-size: 1.1rem; background: none; border: none; padding: 0; }
.close-btn:hover { color: #374151; }
.italic { font-style: italic; font-size: 0.72rem; color: #6b7280; margin-top: 6px; border-top: 1px solid #fde68a; padding-top: 6px; }
#selected-card { display: none; }

/* Legend overlay on map */
.legend-bar { position: absolute; bottom: 56px; left: 8px; right: 8px; z-index: 999; background: rgba(255,255,255,0.92); backdrop-filter: blur(4px); border-radius: 8px; padding: 8px 12px; font-size: 0.75rem; display: flex; align-items: center; gap: 8px; pointer-events: none; }
@media (min-width: 768px) { .legend-bar { bottom: 20px; left: 20px; right: auto; } }
.legend-colors { display: flex; gap: 2px; }
.legend-swatch { width: 20px; height: 12px; border-radius: 2px; }

/* Better popups on mobile */
.leaflet-popup-content { font-size: 13px; line-height: 1.4; }
.leaflet-popup-content b { font-weight: 600; }
</style>
</head>
<body>

<div class="header">
  <div>
    <h1>Mapa volebn√≠ch okrsk≈Ø</h1>
    <p>Praha 2 ‚Äî 45 volebn√≠ch okrsk≈Ø</p>
  </div>
</div>

<div class="main">
  <div id="map"></div>
  <div class="legend-bar">
    <span style="color:#6b7280">P2S podpora:</span>
    <div class="legend-colors">
      <div class="legend-swatch" style="background:#fef08a" title="10%"></div>
      <div class="legend-swatch" style="background:#fde047" title="13%"></div>
      <div class="legend-swatch" style="background:#facc15" title="16%"></div>
      <div class="legend-swatch" style="background:#eab308" title="19%"></div>
      <div class="legend-swatch" style="background:#ca8a04" title="22%"></div>
      <div class="legend-swatch" style="background:#a16207" title="25%+"></div>
    </div>
    <span style="color:#9ca3af">10% ‚Üí 25%+</span>
  </div>
  <button class="info-btn" id="info-btn" onclick="toggleSidebar()">üìä</button>
  <div class="sidebar" id="sidebar">
    <div class="sidebar-handle" onclick="closeSidebar()"></div>
    <div class="sidebar-content">
      <button onclick="closeSidebar()" style="display:block;width:100%;padding:10px;margin-bottom:12px;background:#f3f4f6;border:1px solid #e5e7eb;border-radius:8px;font-size:0.85rem;color:#374151;cursor:pointer;font-weight:500;">‚úï Zav≈ô√≠t</button>
      <div id="selected-card" class="card card-yellow">
        <button class="close-btn" onclick="deselectDistrict()">&times;</button>
        <h3 id="sel-title"></h3>
        <div id="sel-body"></div>
      </div>
      <div class="card">
        <h3>ƒåtvrtƒõ</h3>
        <div id="neighborhoods"></div>
      </div>
      <div class="card">
        <h3>Souhrn</h3>
        <div id="summary"></div>
      </div>
    </div>
  </div>
</div>

<script>
const DATA = {"geo": [{"vo_kod": 26431, "polygon": [[14.430399450629924, 50.07566196153832], [14.430541390095396, 50.07558902667277], [14.431869884655322, 50.07554392546619], [14.432499754721109, 50.07553375691141], [14.432771757502053, 50.075532587964695], [14.433983245794336, 50.075528844047405], [14.434847314715716, 50.07552875865318], [14.434961728776441, 50.075640162084184], [14.434870602999473, 50.07578094400872], [14.433110995801341, 50.07655965353851], [14.4318461687295, 50.07823441415371], [14.430725163272271, 50.07754758713002], [14.430622690054173, 50.077470089775915], [14.430595677094567, 50.0772743863914], [14.430529734636885, 50.07674270318772], [14.430407987330407, 50.07575864758263]], "center": [14.431999574123749, 50.07634658863216], "addressCount": 107}, {"vo_kod": 26433, "polygon": [[14.4303703901577, 50.07525207038389], [14.430517897364057, 50.074155610963864], [14.43054890554026, 50.07396358892385], [14.431934627138206, 50.073246958647445], [14.432348721244598, 50.07224768975749], [14.432431234994025, 50.07217430645202], [14.432722489617493, 50.07218128625576], [14.433211689582427, 50.072200330677354], [14.433632511447643, 50.07252108162599], [14.43311512477879, 50.073814616689596], [14.432692281054099, 50.0750443630165], [14.431623323742167, 50.07526753826639], [14.430666172836862, 50.07530065825262], [14.430475610283828, 50.07530612378421]], "center": [14.432005509481803, 50.073912248379415], "addressCount": 94}, {"vo_kod": 26435, "polygon": [[14.431925630514025, 50.07841106878115], [14.432287135368606, 50.07723697529261], [14.43332514495088, 50.07678779075798], [14.434575677552099, 50.076238140362776], [14.434829109605934, 50.076236775925054], [14.434967436527385, 50.07642970619983], [14.435521899608498, 50.077260790852215], [14.435959979925185, 50.07790387836904], [14.435931218885461, 50.078016777461684], [14.435714744984539, 50.078125057348664], [14.435242585824014, 50.078352851193], [14.434504870640046, 50.07858983085535], [14.4332026839446, 50.07894060623835], [14.433025872778515, 50.078921246232014]], "center": [14.434013173245287, 50.077522413602296], "addressCount": 79}, {"vo_kod": 26437, "polygon": [[14.433191415494123, 50.080838245737624], [14.43394573914118, 50.07913102645547], [14.434015429606207, 50.079008769065105], [14.435119893387931, 50.0788124838012], [14.436077782859266, 50.07827487100901], [14.436648239095591, 50.07811112717087], [14.437267757938496, 50.077969234758214], [14.437527694768116, 50.077910354729774], [14.437771975572051, 50.07797633196215], [14.437888027649358, 50.07819968783433], [14.438406860920086, 50.08108014230976], [14.44032711081988, 50.084689154562874], [14.43694227323434, 50.085965039191414], [14.435486419926283, 50.08356251376331], [14.433311167931748, 50.081121471149096]], "center": [14.436442252972226, 50.080056584944955], "addressCount": 85}, {"vo_kod": 26439, "polygon": [[14.435830981322798, 50.079286038459934], [14.435895759949823, 50.07918676120948], [14.437162727256345, 50.07875116223755], [14.438176015461256, 50.077784799346254], [14.438496848179737, 50.07773066571143], [14.439133454665201, 50.07762494371702], [14.440471612066382, 50.07806132772175], [14.441732656423204, 50.07790686705357], [14.441885495602742, 50.07793280786083], [14.441903314880227, 50.07806606896289], [14.441926988933718, 50.07824458994991], [14.441824718031727, 50.078362337324556], [14.438937285932223, 50.078740147100206], [14.436255502672882, 50.079609640666824], [14.436084879906073, 50.0795744966556], [14.435958324832109, 50.07943733615281]], "center": [14.43877152954675, 50.07853704337548], "addressCount": 73}, {"vo_kod": 26441, "polygon": [[14.444138205195774, 50.08119984680524], [14.44460106113657, 50.0799909509481], [14.444822099676218, 50.079418302306955], [14.446189473146994, 50.079655989049], [14.447288524514665, 50.079845818758905], [14.446822199718616, 50.08017872086078], [14.446642141043032, 50.08030348636444], [14.445454995865498, 50.081097729585586], [14.445283513170203, 50.081151191748795], [14.444581544521547, 50.08123592898762], [14.444263141988925, 50.0812733243279]], "center": [14.445521404486984, 50.080299827385616], "addressCount": 56}, {"vo_kod": 26443, "polygon": [[14.444888903038091, 50.079226811938014], [14.445069836980583, 50.0787442793791], [14.44526216274214, 50.078661167629335], [14.44609883454057, 50.07843731297192], [14.447056064976621, 50.07868295761928], [14.448333457985813, 50.07830361900171], [14.448290780503864, 50.078417104598195], [14.448149857291611, 50.07875451704404], [14.447877420073894, 50.079134585373886], [14.44742724779767, 50.079675473046905], [14.445926316155767, 50.07942917981961]], "center": [14.44672721862667, 50.07889639431242], "addressCount": 41}, {"vo_kod": 26445, "polygon": [[14.444877257218598, 50.07763802337219], [14.444962024268955, 50.077137556384784], [14.446738664700353, 50.07719703732783], [14.448239714530557, 50.07724077238119], [14.448611539497213, 50.07725691282301], [14.448726643442454, 50.07736391343719], [14.44866197700666, 50.07753290461597], [14.448578662116027, 50.07772320969513], [14.448411772520057, 50.07810370612572], [14.446986998364554, 50.07795481262353], [14.44562622922927, 50.07846780421561], [14.445323850737946, 50.07844934997258], [14.445031026287463, 50.078429742380486]], "center": [14.446658940143974, 50.077702938667606], "addressCount": 57}, {"vo_kod": 26447, "polygon": [[14.440191481000943, 50.07607070446417], [14.440267680625345, 50.07543615892679], [14.44071232961002, 50.07458569226881], [14.44082002611729, 50.074505272682245], [14.44174750554294, 50.07451056104761], [14.442967486201201, 50.075456869201865], [14.444192261048716, 50.0754660822826], [14.44417609146492, 50.076157932708966], [14.443745967063183, 50.07659684580521], [14.443408364254687, 50.07684862806199], [14.442336245201163, 50.076878584447186], [14.441692947664759, 50.076145421409365]], "center": [14.442174933867067, 50.075701423395564], "addressCount": 79}, {"vo_kod": 26449, "polygon": [[14.44071187098265, 50.07429114905084], [14.440728522501452, 50.073688459292185], [14.440923938012562, 50.07352077217903], [14.441386178539975, 50.0733252108054], [14.441619575441424, 50.073229309756144], [14.442285480273478, 50.07296017390193], [14.442821733111481, 50.07275209038857], [14.443031956450099, 50.07271784933432], [14.443424246155837, 50.072719209957555], [14.443673979176266, 50.07272185729094], [14.443792620322267, 50.072812841449114], [14.443798613347022, 50.07294669064433], [14.443797912042674, 50.073071598780174], [14.443781836577887, 50.074036631801846], [14.443766312316892, 50.0749898244373], [14.443758424410763, 50.07515039961424], [14.443654876162267, 50.07522329244787], [14.443158361083743, 50.07522189046223], [14.442280997721165, 50.07521233115173], [14.441463760772221, 50.074308418156434]], "center": [14.44254108895497, 50.07402112616782], "addressCount": 75}, {"vo_kod": 26451, "polygon": [[14.437698050662473, 50.073290219016435], [14.438174971478123, 50.07269101290224], [14.43850814660893, 50.07260003737453], [14.43866731415436, 50.07265966963079], [14.438877867178942, 50.07274018081011], [14.439348140974547, 50.072954284627166], [14.43950567883769, 50.073069132658915], [14.440017234672663, 50.0734532384311], [14.44040361527449, 50.07395279001829], [14.440421781439678, 50.07429518418539], [14.44039461896988, 50.075131458259264], [14.439909923047594, 50.076030750739335], [14.439558507867206, 50.075987071403326], [14.4382599756661, 50.07580665795982], [14.437941000140246, 50.075629525552735]], "center": [14.43917024849116, 50.074196173908895], "addressCount": 76}, {"vo_kod": 26453, "polygon": [[14.439414653584516, 50.081224496747154], [14.442110106510967, 50.0772655474964], [14.442239791951316, 50.07714686488035], [14.442538085911195, 50.077124943859715], [14.442861112232613, 50.077109382403684], [14.443189194054543, 50.077100528920475], [14.443537038385127, 50.077106126527475], [14.44415528702456, 50.07711673838206], [14.444725988211365, 50.07712877285103], [14.44483859259709, 50.07727058873322], [14.444888707969778, 50.0778487700005], [14.444814509593856, 50.07841669422959], [14.442719887455052, 50.080837205127075], [14.44094316884871, 50.08171707930125]], "center": [14.443317365522452, 50.077937389641036], "addressCount": 58}, {"vo_kod": 26455, "polygon": [[14.43508333572149, 50.0760163943804], [14.436366824529333, 50.07615630677113], [14.437915845695466, 50.0759680006033], [14.438312304519634, 50.076020658956914], [14.438612687342697, 50.076064912857824], [14.438828953105348, 50.07624557800924], [14.43896502640111, 50.07669160310178], [14.43843329896378, 50.077474742140616], [14.43741684079872, 50.077656056175194], [14.436442883662785, 50.077883321844325], [14.436273436570993, 50.07783675544361], [14.435635132683396, 50.07689561631831], [14.435525384062176, 50.0767326229984], [14.435131585069053, 50.07614508894804]], "center": [14.436946615373197, 50.0767984240911], "addressCount": 70}, {"vo_kod": 26457, "polygon": [[14.437631688338149, 50.07707841981002], [14.43904222062051, 50.076917966205464], [14.439265693235683, 50.07651189410263], [14.439889781213495, 50.076300875067446], [14.440688457174243, 50.076038942471335], [14.441455557284808, 50.07613705559142], [14.441682928175807, 50.07634701170572], [14.441829021416078, 50.076485166053025], [14.441827065032298, 50.07759003327469], [14.441726966341486, 50.077686372617286], [14.441435282963647, 50.077728842380665], [14.440917036347997, 50.077796755748764], [14.439867804307998, 50.077931449928194], [14.438890401397932, 50.07735369685488], [14.437769473851619, 50.077332739629924], [14.437701472822893, 50.07721065019443]], "center": [14.440440463998483, 50.07706191133269], "addressCount": 54}, {"vo_kod": 26459, "polygon": [[14.444076852758956, 50.075141780870496], [14.44408062276887, 50.07493836844236], [14.444087833954724, 50.07461637068291], [14.44418621410216, 50.07452604973703], [14.444977179056554, 50.074528052865624], [14.445574242881634, 50.074532704355356], [14.446587690240644, 50.07547705683374], [14.447472929716362, 50.07547811264141], [14.44758473747548, 50.07557012162147], [14.4475832978136, 50.0759035178147], [14.447574157876998, 50.076091843186504], [14.447471291908737, 50.07617478234622], [14.447199937272996, 50.07617822131614], [14.446354700402662, 50.076170715350926], [14.44527600745746, 50.0761668094934], [14.444876587136056, 50.0761643738378], [14.444427218543227, 50.07615743282318]], "center": [14.445638523838563, 50.07545982876288], "addressCount": 61}, {"vo_kod": 26461, "polygon": [[14.442190228378829, 50.07370992775139], [14.442317624278141, 50.07361845166092], [14.442612020298789, 50.07341113735282], [14.443421784288272, 50.07341880733261], [14.444234449310246, 50.07272410070166], [14.444553748422027, 50.07272454379471], [14.445032608895108, 50.072725289752604], [14.445583458475, 50.072732303422264], [14.445715425442833, 50.072821649256326], [14.445714518034462, 50.073007707640656], [14.445700605470769, 50.07406459116659], [14.445693592124465, 50.074238947191134], [14.445583675875895, 50.07432915745558], [14.445302566888234, 50.074332092315544], [14.444199083086007, 50.07432625473687], [14.443207582035376, 50.07361378860217]], "center": [14.444435212882272, 50.07353890157049], "addressCount": 57}, {"vo_kod": 26463, "polygon": [[14.445986810554324, 50.07515769940675], [14.445988685193761, 50.074804465293724], [14.446005209098198, 50.07389265806329], [14.44602927571855, 50.07282714288331], [14.446182717330945, 50.072735151093966], [14.446650448583647, 50.07273517941009], [14.447021511067108, 50.072735560149745], [14.448443470758427, 50.07309994213494], [14.447610938939674, 50.07406926640622], [14.447586706012421, 50.075162171786516], [14.447464999053887, 50.07524353730239], [14.446897182670174, 50.075240572383684], [14.446364560954095, 50.07523590381546], [14.446102262740567, 50.07523260715743]], "center": [14.446767840834466, 50.07405500976632], "addressCount": 61}, {"vo_kod": 26465, "polygon": [[14.435707896731001, 50.074327103285704], [14.435973066315936, 50.07357258761105], [14.43623542988907, 50.07285231131527], [14.436523923871366, 50.0720155454403], [14.436714865405404, 50.07196463569929], [14.43698877298875, 50.07205946601073], [14.437811433335296, 50.072356105986934], [14.437915785443472, 50.072459810235536], [14.438415161604963, 50.07386476315106], [14.43876662650497, 50.07411492211006], [14.438883236201514, 50.07462765746525], [14.438885712697095, 50.074789150057086], [14.438883469812744, 50.07493443384888], [14.43888082968793, 50.075100737940105], [14.438747391198374, 50.07518677612401], [14.438295480198635, 50.07518648323723], [14.437989185685412, 50.075119742297154], [14.436797355180818, 50.07457573472951], [14.435789154843238, 50.07442404773618]], "center": [14.437212486970454, 50.073711838072526], "addressCount": 89}, {"vo_kod": 26467, "polygon": [[14.43262823490966, 50.0751943459649], [14.432932868433744, 50.07427841799581], [14.433064116937379, 50.07393525862027], [14.43402341491847, 50.07350298070277], [14.433694654648527, 50.07236875213475], [14.43382045424615, 50.07231453489452], [14.434068609595212, 50.072380048877854], [14.435047504629894, 50.07266811192616], [14.435282223611223, 50.07273778927791], [14.435751487170405, 50.07287730846549], [14.43588628559178, 50.07297907883763], [14.43573763553468, 50.0734177193949], [14.435492686315506, 50.07410922277039], [14.435208805763526, 50.074934144268724], [14.435112512159405, 50.07520216394347], [14.434976950098767, 50.075297449322896], [14.434336769848958, 50.075300456847344], [14.433702754293373, 50.07521252308491], [14.432733596080633, 50.075301230250744]], "center": [14.434312463389633, 50.07399509012174], "addressCount": 78}, {"vo_kod": 26469, "polygon": [[14.430998996477328, 50.07056660768679], [14.431078509861349, 50.06991047805507], [14.431098593958417, 50.069764955708656], [14.431121050913976, 50.06960766333244], [14.431227902118174, 50.069505486260496], [14.431555760459771, 50.06962951914868], [14.433196025594698, 50.06920459377349], [14.433651163889598, 50.069167078979376], [14.434338161895871, 50.06935518330817], [14.434586518846636, 50.06977167250601], [14.434040675902306, 50.07050998024419], [14.433689588215678, 50.071527439805365], [14.433268049411128, 50.071950288825654], [14.433205085152295, 50.072012695973996], [14.432933520227055, 50.07200464566477], [14.43271164716372, 50.07199699747653], [14.432471367155474, 50.0719877204214], [14.432247169634454, 50.07106067564532]], "center": [14.43272671285281, 50.070637260299804], "addressCount": 70}, {"vo_kod": 26471, "polygon": [[14.43386603193892, 50.0719386576024], [14.434393003076165, 50.070456741772915], [14.43463700413975, 50.070025901241216], [14.434899182066445, 50.06973180535396], [14.435730051740164, 50.069909845872495], [14.43655885748105, 50.07082282590295], [14.436612804053954, 50.070940679372555], [14.436219680041376, 50.07206215265345], [14.436085428963253, 50.072423471334375], [14.436019713750879, 50.07258728390294], [14.435902717419612, 50.07266170382849], [14.435699219351523, 50.07260695033426], [14.435504892182772, 50.07255019406792], [14.434648432690754, 50.07222894718104], [14.433937256808399, 50.07208717413628]], "center": [14.435279868588855, 50.071205275891614], "addressCount": 94}, {"vo_kod": 26473, "polygon": [[14.43627183383862, 50.070082733899795], [14.437507195596906, 50.07039518493609], [14.4389819417657, 50.07063921023822], [14.43971503146469, 50.07116188775939], [14.440400497700763, 50.07147433330075], [14.440722970993546, 50.07269818521119], [14.441233870139401, 50.0729353842611], [14.441263981100002, 50.07305530222453], [14.441046498436348, 50.07314997731713], [14.44090166614531, 50.07321213960137], [14.440612861204823, 50.07333309099104], [14.440407236797943, 50.073419102433775], [14.440239890232563, 50.07339777502479], [14.438561608858445, 50.07230200141697], [14.436712550360387, 50.07176939513978], [14.436647074396168, 50.07166458953475], [14.436323921272615, 50.070502552125625]], "center": [14.438922697529563, 50.071909126185496], "addressCount": 99}, {"vo_kod": 26475, "polygon": [[14.439934901171473, 50.0709449968221], [14.440166781684466, 50.0708601283381], [14.440334394705683, 50.07079889227663], [14.44101192959422, 50.070623818802986], [14.441265792225977, 50.070609049189], [14.442007717208242, 50.07069786210172], [14.442376190231352, 50.07086629111333], [14.443008637109452, 50.07115697206636], [14.442991176253265, 50.07131416030398], [14.442634415289401, 50.07258116053005], [14.441792671920123, 50.07290581802568], [14.44166595279442, 50.07292738064742], [14.44058169710298, 50.07243575547312], [14.440221430375956, 50.072266503933044], [14.44005978979459, 50.07219004688722], [14.440048583832914, 50.072123621190215]], "center": [14.441467237395031, 50.07164554505173], "addressCount": 84}, {"vo_kod": 26477, "polygon": [[14.437357154958796, 50.06953978768841], [14.438133109173524, 50.06848674502182], [14.438264236086049, 50.06721704145577], [14.438790336211643, 50.06675705070126], [14.440871074909357, 50.0671327841571], [14.447380640930835, 50.06849400502172], [14.445710031526314, 50.06981246106276], [14.44424119838912, 50.070684971819645], [14.44407954467523, 50.07106202369908], [14.443183608308988, 50.07167458559006], [14.442759263444042, 50.07201979922513], [14.440316225191681, 50.07058537085474], [14.438577013872637, 50.07040710231616]], "center": [14.441082335421966, 50.069753615066084], "addressCount": 90}, {"vo_kod": 26479, "polygon": [[14.432555253254336, 50.06923385153156], [14.432743001678988, 50.06886311001245], [14.43289910831739, 50.06858704232299], [14.433008961115348, 50.068454272223114], [14.433214143796867, 50.06833002661201], [14.4348851560596, 50.06812797905373], [14.435884298570295, 50.06704477431098], [14.435964024686964, 50.067132327161524], [14.436419025956928, 50.068495620751], [14.43568032291481, 50.06912103684311], [14.43376443929787, 50.07028678663577], [14.433229036909822, 50.07046041705915], [14.432782175582398, 50.07024980720042]], "center": [14.43473601551833, 50.06856789474836], "addressCount": 57}, {"vo_kod": 26481, "polygon": [[14.432022175382945, 50.06687191927085], [14.433181672209338, 50.067247324388184], [14.434480534965077, 50.06627468754681], [14.434918563263775, 50.06647897616162], [14.43531551200056, 50.06673172360921], [14.43547338624918, 50.06685740974522], [14.435535633996919, 50.06692181686181], [14.435576481939759, 50.0671690212677], [14.435496051220312, 50.06734432836625], [14.434654584543015, 50.06811030637017], [14.43358987113918, 50.06804035228265], [14.433470662529869, 50.06801092878207], [14.433295934133547, 50.06794700653132], [14.433006506327393, 50.06783254940125], [14.432493602178438, 50.06762825456329]], "center": [14.434132074265774, 50.06724432971294], "addressCount": 52}, {"vo_kod": 26483, "polygon": [[14.428091979849633, 50.066312177722594], [14.428326011830803, 50.06610109733283], [14.43002376367722, 50.06607665399941], [14.431006039736122, 50.0651665189543], [14.431702046187919, 50.065172838068534], [14.432684567405582, 50.065188984551554], [14.433943392237728, 50.065930393824004], [14.434267549033326, 50.0661416738244], [14.434071171723474, 50.0666130283603], [14.43359906759608, 50.06686350090368], [14.433371904141412, 50.0669804472718], [14.433162967968592, 50.066962506997015], [14.430922513034929, 50.06635903412002]], "center": [14.431779562851087, 50.06594921330173], "addressCount": 66}, {"vo_kod": 26485, "polygon": [[14.427045310590417, 50.065523770993984], [14.42704758103096, 50.06521684589241], [14.427063228419843, 50.064851930607794], [14.42706885780628, 50.064725276579765], [14.428762210402075, 50.06493044729362], [14.430496008662239, 50.0647898449477], [14.43134899655377, 50.06496026312536], [14.432194273739528, 50.06497534154209], [14.431184316742913, 50.0649589408219], [14.430029024710537, 50.0658817180822], [14.428805368834315, 50.06578312708548], [14.427472647179645, 50.06576871185192]], "center": [14.428958287645315, 50.065269728500326], "addressCount": 82}, {"vo_kod": 26487, "polygon": [[14.424385314178318, 50.06536721445373], [14.425017273715728, 50.064880890987304], [14.426596418655327, 50.064685538164284], [14.427164255593611, 50.065762921039], [14.427888971718598, 50.06633513964914], [14.427455512279087, 50.06633198341437], [14.425990492130536, 50.06631174021534], [14.425771969129663, 50.06628259090744], [14.425575927977487, 50.06623401269306], [14.425364340606436, 50.06615855446435], [14.424846538376357, 50.06591140337302]], "center": [14.425947686092277, 50.065625131801035], "addressCount": 62}, {"vo_kod": 26489, "polygon": [[14.422352170419568, 50.064116472002596], [14.423801538369664, 50.063579664368056], [14.42468611345537, 50.0625801483542], [14.425430911902009, 50.062914202121576], [14.425669358674082, 50.06303478710594], [14.426534232518511, 50.06409300718002], [14.427508324859742, 50.06425874891697], [14.42584631174474, 50.064080564717834], [14.42436658138961, 50.06463349546033], [14.423603495827866, 50.06404450908631]], "center": [14.424838115964851, 50.06368902038908], "addressCount": 55}, {"vo_kod": 26491, "polygon": [[14.415377459292028, 50.066554116124486], [14.41562841780615, 50.06563072735222], [14.415705281472917, 50.0648785119665], [14.415747809526108, 50.06471528238168], [14.415794587764587, 50.06454997896428], [14.415920713106834, 50.0641462016239], [14.417405376740712, 50.06298326586775], [14.424114703381091, 50.061734316834475], [14.422856783421848, 50.06294100092604], [14.422313053548605, 50.06554282634052], [14.422022458183474, 50.065795446288064], [14.421887376642465, 50.06589638618221], [14.421396165195702, 50.0662471352507], [14.421032861623369, 50.06639066450467], [14.41969081811739, 50.06672566740331], [14.418741116051073, 50.06711166385487], [14.418549500220863, 50.067169654396146], [14.418279601581357, 50.0672508409121], [14.418009132882515, 50.06731754556619], [14.417349870768986, 50.06724996351094], [14.415943654129276, 50.067048838945084], [14.415528072739564, 50.06681306182632]], "center": [14.418932631311769, 50.06566405520456], "addressCount": 110}, {"vo_kod": 26493, "polygon": [[14.414890067218073, 50.06900319599896], [14.414987169580792, 50.06852886661315], [14.415025145931562, 50.06835134718283], [14.41537686609507, 50.06785148102065], [14.416355217852374, 50.068014059771755], [14.417053793271295, 50.06785568913917], [14.417043305548562, 50.06846312361767], [14.41658615726992, 50.06961020903114], [14.416643627553144, 50.07055321501955], [14.41649832248084, 50.070638541725124], [14.415970387539561, 50.070607461031585], [14.415811669738277, 50.07059793400794], [14.415556451811304, 50.07058203324952], [14.415469983033853, 50.07048724064997]], "center": [14.415999458147708, 50.069089856843135], "addressCount": 64}, {"vo_kod": 26495, "polygon": [[14.416680682073885, 50.06874901377049], [14.417269337836904, 50.06804251295218], [14.41846706174474, 50.06733624594297], [14.419632612770815, 50.066186118843945], [14.420026089237963, 50.06598128128305], [14.420989253123183, 50.06655506942333], [14.42293594822444, 50.06614390953766], [14.426967506102788, 50.067855088932866], [14.427695824402214, 50.06830301384867], [14.428167159157514, 50.068719655729694], [14.428509398977209, 50.069199381280804], [14.427781960467609, 50.07143326130504], [14.423057761537123, 50.07245154994695], [14.420869086546354, 50.07146793399213], [14.418490629967916, 50.07196353701892], [14.416827844419426, 50.06911447507958]], "center": [14.421093552209962, 50.068737070133906], "addressCount": 163}, {"vo_kod": 26497, "polygon": [[14.414413495702014, 50.07145024088623], [14.414619040172271, 50.07041636447015], [14.414807466769272, 50.069430163194745], [14.41499469250592, 50.0692945515885], [14.416875345532814, 50.06944551072956], [14.417852331213505, 50.06924146449585], [14.418021723360642, 50.069339518005215], [14.418133510486904, 50.06944780585836], [14.41844565266497, 50.069811362457834], [14.418498001119469, 50.069902857279686], [14.418590702840778, 50.07006545229263], [14.418710248037021, 50.07036166369987], [14.418751566776514, 50.070511991727116], [14.418798388650782, 50.07068604169422], [14.417868860161155, 50.07204540834215], [14.418430645937594, 50.07355150785586], [14.417659415470863, 50.07326989746148], [14.41618003176996, 50.073330868194546], [14.415973952737952, 50.07328955451892], [14.415551251483821, 50.073200183050346], [14.415363075814154, 50.07303366281166], [14.415351422589131, 50.07192735326993]], "center": [14.416323876408354, 50.070932608116586], "addressCount": 96}, {"vo_kod": 26499, "polygon": [[14.429406856532852, 50.073397580530525], [14.42948024717022, 50.07246990556082], [14.429603106055545, 50.071073034311844], [14.429701593463296, 50.06983510138721], [14.429734388271426, 50.069530425546624], [14.429871207586762, 50.06946157768999], [14.430613393331978, 50.06948568887652], [14.430728938427356, 50.06958376672655], [14.431371923065322, 50.07082758798101], [14.431959050844181, 50.07088389217099], [14.432017054105238, 50.07129961029826], [14.432055392322436, 50.0715941517885], [14.43209223581808, 50.071879848260615], [14.43208626523328, 50.07223989889164], [14.432005690363294, 50.07244350880592], [14.431560772450311, 50.073523002368184], [14.43149340344101, 50.07367995148078], [14.43132474566952, 50.073758509649764], [14.430588352714894, 50.07357164865116], [14.429527110765086, 50.07349081165044]], "center": [14.430650648017757, 50.0719198075953], "addressCount": 121}, {"vo_kod": 26501, "polygon": [[14.42673383635888, 50.077086386686126], [14.427453985052658, 50.07283948010223], [14.427602306212707, 50.07257497914246], [14.427745779673602, 50.07232193836101], [14.428237217714715, 50.07234174638827], [14.429090000946987, 50.07311106236554], [14.430051501388741, 50.07376964495645], [14.430175084923375, 50.0738783263243], [14.42997662536819, 50.07581459559276], [14.430239039258366, 50.07692572535162], [14.430098007527716, 50.07702079462364], [14.429813750383893, 50.077037028630926], [14.428404031886728, 50.0770904419061], [14.426924718472241, 50.077170533143466]], "center": [14.42870104811208, 50.07523308184503], "addressCount": 109}, {"vo_kod": 26503, "polygon": [[14.419004372763556, 50.07337125848123], [14.42295681635174, 50.07092040343743], [14.428338291758271, 50.069536287000695], [14.429070164843978, 50.06947799465262], [14.429353667978871, 50.07048091005679], [14.428866643239418, 50.07519733120484], [14.427351812507917, 50.07483083566552], [14.42538443784915, 50.07542840811389], [14.425195851451695, 50.07543649051025], [14.424333364987348, 50.07547331063143], [14.42301119262953, 50.07546234330465], [14.4217541917964, 50.07550668666511]], "center": [14.424718859392362, 50.07377865683136], "addressCount": 130}, {"vo_kod": 26505, "polygon": [[14.42096248030998, 50.0758680419236], [14.421084938363077, 50.07578340844759], [14.423818762021321, 50.07572135407153], [14.426189446137881, 50.07472550013849], [14.426664871527699, 50.07487776357316], [14.42779206788591, 50.07526187555297], [14.427745059656873, 50.07541454495634], [14.427079119017515, 50.076087750315736], [14.426545042722863, 50.077069676505225], [14.426352617050119, 50.07717289912768], [14.423818423121105, 50.07725278517668], [14.421590411342793, 50.078641792108414], [14.421095887925299, 50.07816453495597], [14.421296175048324, 50.0770188315465]], "center": [14.4243680053961, 50.07626435825763], "addressCount": 115}, {"vo_kod": 26507, "polygon": [[14.414323227204397, 50.076495681865474], [14.41441027815244, 50.076386769351956], [14.414633764693068, 50.076346127943395], [14.416065515767768, 50.076604507188], [14.417621201728895, 50.07596379961305], [14.418910845908439, 50.07600235015859], [14.420398565539992, 50.078100783427445], [14.421733298485043, 50.078864642595995], [14.421479380072617, 50.07900207516331], [14.420808120317885, 50.07902150147249], [14.419787000946622, 50.07906902286425], [14.417369910828326, 50.07765344671727], [14.41463063185247, 50.077317800949054], [14.414513987631818, 50.077188659381704], [14.41445205148392, 50.07697587453278], [14.41440568799629, 50.0768162029294]], "center": [14.417362902993695, 50.07735554074006], "addressCount": 93}, {"vo_kod": 26509, "polygon": [[14.413672820890957, 50.07407945199562], [14.414128865334453, 50.073482460397415], [14.414257857198663, 50.07339632511837], [14.415301777809718, 50.073413779780466], [14.4158810967209, 50.073520569855276], [14.417238824526825, 50.073802242421436], [14.417346416867568, 50.07390117329153], [14.417369571652614, 50.074228053931485], [14.416449496145615, 50.075900015575485], [14.416394618409095, 50.076344414724836], [14.416253599143902, 50.076439289094566], [14.416025913195861, 50.07645342258249], [14.415580323712177, 50.07647946921977], [14.41505808928792, 50.076206565717584], [14.414875108641466, 50.07608888119839], [14.414190831964246, 50.07544692231015], [14.414102598297402, 50.075344530580104], [14.414039474910314, 50.075178835191146]], "center": [14.415387420487331, 50.07464039192537], "addressCount": 84}, {"vo_kod": 26511, "polygon": [[14.414916886402088, 50.07544673418204], [14.41498628522187, 50.075083490248716], [14.41502016369247, 50.07490932863396], [14.415131884491514, 50.07435551770466], [14.415282012743658, 50.0742938535515], [14.416781253763489, 50.074444124654285], [14.417785156334533, 50.07386153658262], [14.42097712182916, 50.07363503008279], [14.422118751546506, 50.07374620847697], [14.422379956036117, 50.074269784112516], [14.420478261796902, 50.0745731339942], [14.418525198944167, 50.07559652859561], [14.417644754513823, 50.07571194060085], [14.416680329625574, 50.07565690100843], [14.415395265452208, 50.07557126307605], [14.415020839132763, 50.07554026217165]], "center": [14.417125597241794, 50.07480664238204], "addressCount": 63}], "voToDistrict": {"26431": "2001", "26433": "2002", "26435": "2003", "26437": "2004", "26439": "2005", "26441": "2006", "26443": "2007", "26445": "2008", "26447": "2009", "26449": "2010", "26451": "2011", "26453": "2012", "26455": "2013", "26457": "2014", "26459": "2015", "26461": "2016", "26463": "2017", "26465": "2018", "26467": "2019", "26469": "2020", "26471": "2021", "26473": "2022", "26475": "2023", "26477": "2024", "26479": "2025", "26481": "2026", "26483": "2027", "26485": "2028", "26487": "2029", "26489": "2030", "26491": "2031", "26493": "2032", "26495": "2033", "26497": "2034", "26499": "2035", "26501": "2036", "26503": "2037", "26505": "2038", "26507": "2039", "26509": "2040", "26511": "2041"}, "distToVo": {"2001": 26431, "2002": 26433, "2003": 26435, "2004": 26437, "2005": 26439, "2006": 26441, "2007": 26443, "2008": 26445, "2009": 26447, "2010": 26449, "2011": 26451, "2012": 26453, "2013": 26455, "2014": 26457, "2015": 26459, "2016": 26461, "2017": 26463, "2018": 26465, "2019": 26467, "2020": 26469, "2021": 26471, "2022": 26473, "2023": 26475, "2024": 26477, "2025": 26479, "2026": 26481, "2027": 26483, "2028": 26485, "2029": 26487, "2030": 26489, "2031": 26491, "2032": 26493, "2033": 26495, "2034": 26497, "2035": 26499, "2036": 26501, "2037": 26503, "2038": 26505, "2039": 26507, "2040": 26509, "2041": 26511}, "districts": [{"id": "2005", "neighborhood": "Vinohrady", "p2sSupport2022": 29.9, "turnout2022": 48.1, "universityEducation": 48.5, "priority": "low", "notes": "Strongest P2S district"}, {"id": "2004", "neighborhood": "Vinohrady", "p2sSupport2022": 26.5, "turnout2022": 48.0, "universityEducation": 55.1, "priority": "low", "notes": null}, {"id": "2006", "neighborhood": "Vinohrady", "p2sSupport2022": 25.8, "turnout2022": 49.0, "universityEducation": 56.8, "priority": "low", "notes": null}, {"id": "2025", "neighborhood": "Vinohrady", "p2sSupport2022": 24.2, "turnout2022": 44.2, "universityEducation": 53.8, "priority": "low", "notes": null}, {"id": "2009", "neighborhood": "Vinohrady", "p2sSupport2022": 24.4, "turnout2022": 45.2, "universityEducation": 54.5, "priority": "low", "notes": null}, {"id": "2012", "neighborhood": "Vinohrady", "p2sSupport2022": 23.9, "turnout2022": 39.7, "universityEducation": 52.0, "priority": "low", "notes": null}, {"id": "2007", "neighborhood": "Vinohrady", "p2sSupport2022": 23.8, "turnout2022": 46.2, "universityEducation": 53.5, "priority": "low", "notes": null}, {"id": "2013", "neighborhood": "Vinohrady", "p2sSupport2022": 22.6, "turnout2022": 50.6, "universityEducation": 55.2, "priority": "low", "notes": null}, {"id": "2016", "neighborhood": "Vinohrady", "p2sSupport2022": 22.2, "turnout2022": 47.2, "universityEducation": 50.5, "priority": "low", "notes": null}, {"id": "2010", "neighborhood": "Vinohrady", "p2sSupport2022": 21.9, "turnout2022": 47.4, "universityEducation": 50.2, "priority": "low", "notes": null}, {"id": "2001", "neighborhood": "Vinohrady", "p2sSupport2022": 20.5, "turnout2022": 44.5, "universityEducation": 52.0, "priority": "low", "notes": null}, {"id": "2002", "neighborhood": "Vinohrady", "p2sSupport2022": 19.8, "turnout2022": 45.0, "universityEducation": 51.5, "priority": "low", "notes": null}, {"id": "2003", "neighborhood": "Vinohrady", "p2sSupport2022": 21.2, "turnout2022": 46.0, "universityEducation": 53.0, "priority": "low", "notes": null}, {"id": "2008", "neighborhood": "Vinohrady", "p2sSupport2022": 20.1, "turnout2022": 43.5, "universityEducation": 51.0, "priority": "low", "notes": null}, {"id": "2011", "neighborhood": "Vinohrady", "p2sSupport2022": 19.5, "turnout2022": 42.8, "universityEducation": 50.5, "priority": "medium", "notes": null}, {"id": "2014", "neighborhood": "Vinohrady", "p2sSupport2022": 18.8, "turnout2022": 41.5, "universityEducation": 49.5, "priority": "medium", "notes": null}, {"id": "2015", "neighborhood": "Vinohrady", "p2sSupport2022": 19.2, "turnout2022": 42.0, "universityEducation": 50.0, "priority": "medium", "notes": null}, {"id": "2017", "neighborhood": "Vinohrady", "p2sSupport2022": 18.5, "turnout2022": 40.8, "universityEducation": 49.0, "priority": "medium", "notes": null}, {"id": "2018", "neighborhood": "Vinohrady", "p2sSupport2022": 17.8, "turnout2022": 39.5, "universityEducation": 48.0, "priority": "medium", "notes": null}, {"id": "2019", "neighborhood": "Vinohrady", "p2sSupport2022": 17.2, "turnout2022": 38.5, "universityEducation": 47.5, "priority": "medium", "notes": null}, {"id": "2021", "neighborhood": "Vinohrady", "p2sSupport2022": 16.5, "turnout2022": 37.0, "universityEducation": 46.5, "priority": "medium", "notes": null}, {"id": "2023", "neighborhood": "Vinohrady", "p2sSupport2022": 15.8, "turnout2022": 35.5, "universityEducation": 45.5, "priority": "medium", "notes": null}, {"id": "2026", "neighborhood": "Vinohrady", "p2sSupport2022": 18.0, "turnout2022": 41.0, "universityEducation": 48.5, "priority": "medium", "notes": null}, {"id": "2020", "neighborhood": "Vinohrady", "p2sSupport2022": 14.9, "turnout2022": 19.6, "universityEducation": 51.0, "priority": "high", "notes": "CRITICAL: Catastrophic turnout (20%), GOTV priority"}, {"id": "2024", "neighborhood": "Vinohrady", "p2sSupport2022": 11.8, "turnout2022": 42.3, "universityEducation": 52.0, "priority": "high", "notes": "CRITICAL: Strong underperformance (-8pp), investigate"}, {"id": "2022", "neighborhood": "Vinohrady", "p2sSupport2022": 13.5, "turnout2022": 43.0, "universityEducation": 53.0, "priority": "high", "notes": "CRITICAL: Strong underperformance (-6pp), investigate"}, {"id": "2031", "neighborhood": "Nov√© Mƒõsto", "p2sSupport2022": 19.9, "turnout2022": 42.5, "universityEducation": 50.0, "priority": "medium", "notes": null}, {"id": "2032", "neighborhood": "Nov√© Mƒõsto", "p2sSupport2022": 18.2, "turnout2022": 41.0, "universityEducation": 49.0, "priority": "medium", "notes": null}, {"id": "2033", "neighborhood": "Nov√© Mƒõsto", "p2sSupport2022": 17.5, "turnout2022": 40.5, "universityEducation": 48.5, "priority": "medium", "notes": null}, {"id": "2034", "neighborhood": "Nov√© Mƒõsto", "p2sSupport2022": 17.0, "turnout2022": 40.0, "universityEducation": 48.0, "priority": "medium", "notes": null}, {"id": "2035", "neighborhood": "Nov√© Mƒõsto", "p2sSupport2022": 16.5, "turnout2022": 39.5, "universityEducation": 47.5, "priority": "medium", "notes": null}, {"id": "2036", "neighborhood": "Nov√© Mƒõsto", "p2sSupport2022": 16.0, "turnout2022": 38.5, "universityEducation": 47.0, "priority": "medium", "notes": null}, {"id": "2037", "neighborhood": "Nov√© Mƒõsto", "p2sSupport2022": 15.5, "turnout2022": 37.5, "universityEducation": 46.5, "priority": "medium", "notes": null}, {"id": "2038", "neighborhood": "Nov√© Mƒõsto", "p2sSupport2022": 14.9, "turnout2022": 33.2, "universityEducation": 46.0, "priority": "high", "notes": "Low turnout, GOTV opportunity"}, {"id": "2039", "neighborhood": "Nov√© Mƒõsto", "p2sSupport2022": 15.8, "turnout2022": 38.0, "universityEducation": 47.0, "priority": "medium", "notes": null}, {"id": "2040", "neighborhood": "Nov√© Mƒõsto", "p2sSupport2022": 14.7, "turnout2022": 36.5, "universityEducation": 45.5, "priority": "medium", "notes": null}, {"id": "2027", "neighborhood": "Nusle", "p2sSupport2022": 20.3, "turnout2022": 38.5, "universityEducation": 47.0, "priority": "medium", "notes": null}, {"id": "2028", "neighborhood": "Nusle", "p2sSupport2022": 14.9, "turnout2022": 36.0, "universityEducation": 44.0, "priority": "medium", "notes": null}, {"id": "2029", "neighborhood": "Nusle", "p2sSupport2022": 18.6, "turnout2022": 39.0, "universityEducation": 46.0, "priority": "medium", "notes": null}, {"id": "2030", "neighborhood": "Nusle", "p2sSupport2022": 12.1, "turnout2022": 35.7, "universityEducation": 43.5, "priority": "high", "notes": "Underperforming, messaging opportunity"}, {"id": "2041", "neighborhood": "Vy≈°ehrad", "p2sSupport2022": 18.44, "turnout2022": 38.2, "universityEducation": 48.0, "priority": "medium", "notes": null}, {"id": "2042", "neighborhood": "Nov√© Mƒõsto", "p2sSupport2022": 15.2, "turnout2022": 37.0, "universityEducation": 46.0, "priority": "medium", "notes": null}, {"id": "2043", "neighborhood": "Vinohrady", "p2sSupport2022": 19.0, "turnout2022": 43.0, "universityEducation": 51.0, "priority": "low", "notes": null}, {"id": "2044", "neighborhood": "Vinohrady", "p2sSupport2022": 18.5, "turnout2022": 42.5, "universityEducation": 50.5, "priority": "medium", "notes": null}, {"id": "2045", "neighborhood": "Nov√© Mƒõsto", "p2sSupport2022": 15.0, "turnout2022": 36.0, "universityEducation": 45.5, "priority": "medium", "notes": null}]};

const NEIGHBORHOODS = ['Vinohrady', 'Nov√© Mƒõsto', 'Nusle', 'Vy≈°ehrad'];
const distById = {};
DATA.districts.forEach(d => distById[d.id] = d);
const voToDistrict = DATA.voToDistrict;

function getP2SColor(s) {
  if (s >= 25) return '#a16207';
  if (s >= 22) return '#ca8a04';
  if (s >= 19) return '#eab308';
  if (s >= 16) return '#facc15';
  if (s >= 13) return '#fde047';
  return '#fef08a';
}

function getNeighborhood(center) {
  const [lng, lat] = center;
  if (lat > 50.072) return lng > 14.43 ? 'Vinohrady' : 'Nov√© Mƒõsto';
  return lng > 14.43 ? 'Nusle' : 'Vy≈°ehrad';
}

function buildGeoJSON() {
  return {
    type: 'FeatureCollection',
    features: DATA.geo.map(g => {
      const distId = voToDistrict[g.vo_kod] || ('RU' + g.vo_kod);
      const d = distById[distId];
      const nh = d ? d.neighborhood : getNeighborhood(g.center);
      return {
        type: 'Feature',
        properties: {
          id: distId, neighborhood: nh,
          p2sSupport2022: d ? d.p2sSupport2022 : 18 + Math.random() * 8,
          turnout2022: d ? d.turnout2022 : 40 + Math.random() * 10,
          universityEducation: d ? (d.universityEducation || 50) : 50,
          priority: d ? d.priority : 'medium',
          notes: d ? d.notes : null
        },
        geometry: { type: 'Polygon', coordinates: [[...g.polygon, g.polygon[0]]] }
      };
    })
  };
}

const PRAHA2 = [[14.4115,50.0756],[14.4118,50.0741],[14.4123,50.0725],[14.4126,50.0706],[14.4130,50.0688],[14.4134,50.0671],[14.4138,50.0659],[14.4142,50.0647],[14.4148,50.0634],[14.4152,50.0625],[14.4158,50.0618],[14.4171,50.0625],[14.4185,50.0632],[14.4203,50.0629],[14.4213,50.0621],[14.4222,50.0618],[14.4243,50.0610],[14.4253,50.0620],[14.4268,50.0630],[14.4261,50.0635],[14.4267,50.0639],[14.4279,50.0642],[14.4290,50.0643],[14.4301,50.0644],[14.4315,50.0646],[14.4326,50.0648],[14.4339,50.0652],[14.4354,50.0660],[14.4360,50.0665],[14.4365,50.0671],[14.4368,50.0678],[14.4380,50.0671],[14.4388,50.0666],[14.4404,50.0665],[14.4413,50.0666],[14.4427,50.0669],[14.4438,50.0674],[14.4451,50.0679],[14.4466,50.0681],[14.4479,50.0681],[14.4486,50.0683],[14.4486,50.0689],[14.4484,50.0694],[14.4476,50.0698],[14.4461,50.0704],[14.4444,50.0710],[14.4437,50.0715],[14.4426,50.0723],[14.4431,50.0726],[14.4458,50.0726],[14.4492,50.0727],[14.4493,50.0735],[14.4493,50.0742],[14.4486,50.0741],[14.4486,50.0754],[14.4491,50.0754],[14.4490,50.0771],[14.4485,50.0783],[14.4482,50.0790],[14.4474,50.0800],[14.4456,50.0812],[14.4441,50.0815],[14.4426,50.0816],[14.4412,50.0818],[14.4395,50.0820],[14.4399,50.0832],[14.4408,50.0852],[14.4393,50.0859],[14.4381,50.0863],[14.4372,50.0866],[14.4366,50.0859],[14.4357,50.0842],[14.4345,50.0827],[14.4339,50.0819],[14.4333,50.0813],[14.4328,50.0810],[14.4336,50.0804],[14.4328,50.0791],[14.4316,50.0784],[14.4307,50.0778],[14.4304,50.0771],[14.4266,50.0772],[14.4239,50.0774],[14.4213,50.0775],[14.4215,50.0782],[14.4220,50.0791],[14.4196,50.0792],[14.4195,50.0784],[14.4180,50.0779],[14.4164,50.0775],[14.4151,50.0774],[14.4144,50.0774],[14.4141,50.0763],[14.4139,50.0758],[14.4115,50.0756]];

let selectedDistrict = null, map, geoLayer;

// Sidebar toggle for mobile
function toggleSidebar() {
  const sb = document.getElementById('sidebar');
  sb.classList.toggle('open');
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
}
// Close sidebar when tapping map on mobile
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('map').addEventListener('click', (e) => {
    // Only close if not clicking a district (popup handles that)
    if (window.innerWidth < 768 && !e.target.closest('.leaflet-popup')) {
      // Small delay to let district click fire first
      setTimeout(() => {
        if (!selectedDistrict) closeSidebar();
      }, 50);
    }
  });
});

document.addEventListener('DOMContentLoaded', () => {
  map = L.map('map', { zoomControl: false }).setView([50.073, 14.432], 14);
  L.control.zoom({ position: 'topright' }).addTo(map);
  
  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OSM &copy; CARTO', maxZoom: 19
  }).addTo(map);

  L.geoJSON({ type:'Feature', geometry:{ type:'Polygon', coordinates:[PRAHA2] }}, {
    style: { fillColor:'transparent', weight:3, color:'#374151', dashArray:'5,5', fillOpacity:0 }
  }).addTo(map);

  renderMap();
  renderSidebar();
});

function renderMap() {
  if (geoLayer) map.removeLayer(geoLayer);
  const geojson = buildGeoJSON();
  geoLayer = L.geoJSON(geojson, {
    style: f => {
      const isSel = selectedDistrict === f.properties.id;
      return { fillColor: getP2SColor(f.properties.p2sSupport2022), weight: isSel?3:1, color: isSel?'#1f2937':'#6b7280', fillOpacity:0.7 };
    },
    onEachFeature: (f, layer) => {
      const p = f.properties;
      const priLabel = p.priority==='high'?'Vysok√°':p.priority==='medium'?'St≈ôedn√≠':'N√≠zk√°';
      const priColor = p.priority==='high'?'#dc2626':p.priority==='medium'?'#d97706':'#16a34a';
      layer.bindPopup(
        '<b>Okrsek '+p.id+'</b><br>'+p.neighborhood+
        '<br>P2S: <b style="color:#a16207">'+p.p2sSupport2022.toFixed(1)+'%</b>'+
        '<br>√öƒçast: '+p.turnout2022.toFixed(1)+'%'+
        '<br>Priorita: <b style="color:'+priColor+'">'+priLabel+'</b>'+
        (p.notes?'<br><em style="color:#6b7280;font-size:11px">'+p.notes+'</em>':''),
        { maxWidth: 220 }
      );
      layer.on('click', () => { selectDistrict(p.id); });
      layer.on('mouseover', e => e.target.setStyle({weight:2,color:'#1f2937'}));
      layer.on('mouseout', e => { if(selectedDistrict!==p.id) geoLayer.resetStyle(e.target); });
    }
  }).addTo(map);
  map.fitBounds(geoLayer.getBounds(), {padding:[20,20]});
}

function selectDistrict(id) {
  selectedDistrict = id;
  renderMap();
  const d = distById[id];
  if (!d) { deselectDistrict(); return; }
  const card = document.getElementById('selected-card');
  card.style.display = 'block';
  document.getElementById('sel-title').textContent = 'Okrsek ' + d.id;
  const pClass = d.priority==='high'?'red':d.priority==='medium'?'amber':'green';
  document.getElementById('sel-body').innerHTML =
    '<div class="stat-row"><span class="stat-label">ƒåtvr≈•:</span><span class="stat-val">'+d.neighborhood+'</span></div>'+
    '<div class="stat-row"><span class="stat-label">P2S 2022:</span><span class="stat-val yellow">'+d.p2sSupport2022+'%</span></div>'+
    '<div class="stat-row"><span class="stat-label">√öƒçast 2022:</span><span class="stat-val">'+d.turnout2022+'%</span></div>'+
    '<div class="stat-row"><span class="stat-label">V≈† vzdƒõl√°n√≠:</span><span class="stat-val">'+(d.universityEducation||'‚Äî')+'%</span></div>'+
    '<div class="stat-row"><span class="stat-label">Priorita:</span><span class="stat-val '+pClass+'">'+(d.priority==='high'?'Vysok√°':d.priority==='medium'?'St≈ôedn√≠':'N√≠zk√°')+'</span></div>'+
    (d.notes?'<div class="italic">'+d.notes+'</div>':'');
  // Open sidebar on mobile
  document.getElementById('sidebar').classList.add('open');
}

function deselectDistrict() {
  selectedDistrict = null;
  document.getElementById('selected-card').style.display = 'none';
  renderMap();
}

function renderSidebar() {
  let nh = '';
  NEIGHBORHOODS.forEach(n => {
    const dists = DATA.districts.filter(d => d.neighborhood === n);
    const avg = dists.length ? (dists.reduce((s,d) => s+d.p2sSupport2022, 0) / dists.length).toFixed(1) : '0';
    nh += '<div class="hood"><div style="display:flex;justify-content:space-between;align-items:center"><span class="hood-name">'+n+'</span><span class="hood-meta">'+dists.length+' okrsk≈Ø</span></div><div class="hood-stats"><div><span class="stat-label">√ò P2S: </span><span class="yellow stat-val">'+avg+'%</span></div></div></div>';
  });
  document.getElementById('neighborhoods').innerHTML = nh;

  const highPri = DATA.districts.filter(d => d.priority === 'high').length;
  const avgSupport = (DATA.districts.reduce((s,d) => s+d.p2sSupport2022, 0) / DATA.districts.length).toFixed(1);
  document.getElementById('summary').innerHTML =
    '<div class="stat-row"><span class="stat-label">Celkem okrsk≈Ø:</span><span class="stat-val">'+DATA.districts.length+'</span></div>'+
    '<div class="stat-row"><span class="stat-label">√ò P2S 2022:</span><span class="stat-val yellow">'+avgSupport+'%</span></div>'+
    '<div class="stat-row"><span class="stat-label">Prioritn√≠ okrsky:</span><span class="stat-val red">'+highPri+'</span></div>';
}
</script>
</body>
</html>